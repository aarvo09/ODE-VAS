<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODE Visualizer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">

        <div class="input-panel">
            <h2>Differential Equation Solver</h2>
            
            <div class="input-group">
                <label for="equation">Differential Equation (dy/dx = f(x, y))</label>
                <input type="text" id="equation" placeholder="e.g., x + y, sin(x)*y, exp(x)">
                <small style="color: #666; font-size: 0.8em; display: block; margin-top: 4px;">
                    Supported: x, y, +, -, *, /, sin, cos, exp, tan, log, sqrt
                </small>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="x0">Initial x₀</label>
                    <input type="number" id="x0" step="0.1" placeholder="0" required>
                </div>
                
                <div class="input-group">
                    <label for="y0">Initial y₀</label>
                    <input type="number" id="y0" step="0.1" placeholder="1" required>
                </div>
            </div>
            
            <button id="simulate-btn" class="simulate-btn">Simulate</button>
            
            <div id="output" class="output"></div>
        </div>
        
        <div class="visualization-area">
            <p>Visualization will appear here</p>
        </div>
    </div>

    <script>
        document.getElementById('simulate-btn').addEventListener('click', function() {
            const equation = document.getElementById('equation').value;
            const x0 = document.getElementById('x0').value;
            const y0 = document.getElementById('y0').value;
            
         
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '<em>Processing...</em>';
            outputDiv.style.backgroundColor = '#e3f2fd';
            outputDiv.style.color = '#1976d2';
            
            fetch('/simulate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    equation: equation,
                    x0: x0,
                    y0: y0
                })
            })
            .then(response => {
            
                return response.json().then(data => ({
                    status: response.status,
                    data: data
                }));
            })
            .then(({status, data}) => {
                if (status === 200 && data.status === 'success') {
                    outputDiv.innerHTML = `
                        <div style="margin-bottom: 8px;">
                            <strong style="color: #2e7d32;">✓ Successfully Parsed</strong>
                        </div>
                        <div style="font-size: 0.85em; line-height: 1.8;">
                            <strong>Input:</strong> dy/dx = ${escapeHtml(data.equation)}<br>
                            <strong>Parsed:</strong> dy/dx = ${escapeHtml(data.parsed_expression)}<br>
                            <strong>Initial:</strong> x₀ = ${data.x0}, y₀ = ${data.y0}
                        </div>
                    `;
                    outputDiv.style.backgroundColor = '#d4edda';
                    outputDiv.style.color = '#155724';
                } else {
                    // Error from backend
                    const errorType = data.error_type || 'unknown';
                    let errorIcon = '✗';
                    let errorTitle = 'Error';
                    
                    if (errorType === 'validation') {
                        errorIcon = '⚠';
                        errorTitle = 'Validation Error';
                    } else if (errorType === 'parse') {
                        errorIcon = '⚠';
                        errorTitle = 'Parse Error';
                    }
                    
                    outputDiv.innerHTML = `
                        <div style="margin-bottom: 8px;">
                            <strong style="color: #c62828;">${errorIcon} ${errorTitle}</strong>
                        </div>
                        <div style="font-size: 0.85em;">
                            ${escapeHtml(data.message)}
                        </div>
                    `;
                    outputDiv.style.backgroundColor = '#f8d7da';
                    outputDiv.style.color = '#721c24';
                }
            })
            .catch(error => {
                outputDiv.innerHTML = `
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #c62828;">✗ Connection Error</strong>
                    </div>
                    <div style="font-size: 0.85em;">
                        Failed to connect to server. Please make sure the server is running.
                    </div>
                `;
                outputDiv.style.backgroundColor = '#f8d7da';
                outputDiv.style.color = '#721c24';
                console.error('Error:', error);
            });
        });
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
