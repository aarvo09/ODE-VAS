<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODE Solver - ODE VAS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="input-panel">
            <div class="header-nav">
                <a href="/" class="back-link">← Home</a>
                <h2>Differential Equation Solver</h2>
            </div>
            
            <div class="input-group">
                <label for="equation">Differential Equation (dy/dx = f(x, y))</label>
                <input type="text" id="equation" placeholder="e.g., x + y, -k*y, sin(x)*y">
                <small style="color: #666; font-size: 0.8em; display: block; margin-top: 4px;">
                    Supported: x, y, +, -, *, /, sin, cos, exp, tan, log, sqrt, parameters (a-z)
                </small>
            </div>
            
            <div class="input-group">
                <label for="parameters">Parameters (optional)</label>
                <input type="text" id="parameters" placeholder="e.g., k=0.5, a=2, b=1.5">
                <small style="color: #666; font-size: 0.8em; display: block; margin-top: 4px;">
                    Format: name=value separated by commas. Use these in your equation.
                </small>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="x0">Initial x₀</label>
                    <input type="number" id="x0" step="0.1" placeholder="0" required>
                </div>
                
                <div class="input-group">
                    <label for="y0">Initial y₀</label>
                    <input type="number" id="y0" step="0.1" placeholder="1" required>
                </div>
            </div>
            
            <div class="input-group">
                <label for="domain">Solution Domain</label>
                <div class="input-row">
                    <div class="input-group">
                        <label for="x_start" style="font-size: 0.85em;">Start x</label>
                        <input type="number" id="x_start" step="0.1" placeholder="0" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="x_end" style="font-size: 0.85em;">End x</label>
                        <input type="number" id="x_end" step="0.1" placeholder="10" required>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <label for="step_size">Step Size (h)</label>
                <input type="number" id="step_size" step="0.01" placeholder="0.1" min="0.001" required>
                <small style="color: #666; font-size: 0.8em; display: block; margin-top: 4px;">
                    Smaller steps = more accurate but slower
                </small>
            </div>
            
            <button id="simulate-btn" class="simulate-btn">Simulate</button>
            
            <div id="output" class="output"></div>
        </div>
        
        <div class="visualization-area">
            <p>Visualization will appear here</p>
        </div>
    </div>

    <script>
        document.getElementById('simulate-btn').addEventListener('click', function() {
            const equation = document.getElementById('equation').value;
            const parameters = document.getElementById('parameters').value;
            const x0 = document.getElementById('x0').value;
            const y0 = document.getElementById('y0').value;
            const x_start = document.getElementById('x_start').value;
            const x_end = document.getElementById('x_end').value;
            const step_size = document.getElementById('step_size').value;
            
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '<em>Processing...</em>';
            outputDiv.style.backgroundColor = '#e3f2fd';
            outputDiv.style.color = '#1976d2';
            
            fetch('/simulate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    equation: equation,
                    parameters: parameters,
                    x0: x0,
                    y0: y0,
                    x_start: x_start,
                    x_end: x_end,
                    step_size: step_size
                })
            })
            .then(response => {
                return response.json().then(data => ({
                    status: response.status,
                    data: data
                }));
            })
            .then(({status, data}) => {
                if (status === 200 && data.status === 'success') {
                    let outputHTML = `
                        <div style="margin-bottom: 8px;">
                            <strong style="color: #2e7d32;">✓ Successfully Configured</strong>
                        </div>
                        <div style="font-size: 0.85em; line-height: 1.8;">
                            <strong>Input:</strong> dy/dx = ${escapeHtml(data.equation)}<br>`;
                    
                    if (data.parameters && Object.keys(data.parameters).length > 0) {
                        const paramStr = Object.entries(data.parameters)
                            .map(([k, v]) => `${k}=${v}`)
                            .join(', ');
                        outputHTML += `<strong>Parameters:</strong> ${escapeHtml(paramStr)}<br>`;
                    }
                    
                    outputHTML += `<strong>Parsed:</strong> dy/dx = ${escapeHtml(data.parsed_expression)}<br>
                            <strong>Initial:</strong> x₀ = ${data.x0}, y₀ = ${data.y0}<br>
                            <strong>Domain:</strong> x ∈ [${data.x_start}, ${data.x_end}]<br>
                            <strong>Step size:</strong> h = ${data.step_size}
                        </div>
                    `;
                    outputDiv.innerHTML = outputHTML;
                    outputDiv.style.backgroundColor = '#d4edda';
                    outputDiv.style.color = '#155724';
                } else {
                    const errorType = data.error_type || 'unknown';
                    let errorIcon = '✗';
                    let errorTitle = 'Error';
                    
                    if (errorType === 'validation') {
                        errorIcon = '⚠';
                        errorTitle = 'Validation Error';
                    } else if (errorType === 'parse') {
                        errorIcon = '⚠';
                        errorTitle = 'Parse Error';
                    }
                    
                    outputDiv.innerHTML = `
                        <div style="margin-bottom: 8px;">
                            <strong style="color: #c62828;">${errorIcon} ${errorTitle}</strong>
                        </div>
                        <div style="font-size: 0.85em;">
                            ${escapeHtml(data.message)}
                        </div>
                    `;
                    outputDiv.style.backgroundColor = '#f8d7da';
                    outputDiv.style.color = '#721c24';
                }
            })
            .catch(error => {
                outputDiv.innerHTML = `
                    <div style="margin-bottom: 8px;">
                        <strong style="color: #c62828;">✗ Connection Error</strong>
                    </div>
                    <div style="font-size: 0.85em;">
                        Failed to connect to server. Please make sure the server is running.
                    </div>
                `;
                outputDiv.style.backgroundColor = '#f8d7da';
                outputDiv.style.color = '#721c24';
                console.error('Error:', error);
            });
        });
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>

